<!DOCTYPE HTML>
<html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><script type="text/javascript" src="https://cdn.jsdelivr.net/combine/npm/twind/twind.umd.min.js,npm/twind/observe/observe.umd.min.js"></script><script type="text/javascript">twind.setup({})
twindObserve.observe(document.documentElement)</script><title>Working with files – Ema</title><meta name="description" content="Ema static site generator (Jamstack) in Haskell"><link href="/ema.svg" rel="icon" /><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#DB2777"><link href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/themes/prism-tomorrow.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/combine/npm/prismjs@1.23.0/prism.min.js,npm/prismjs@1.23.0/plugins/autoloader/prism-autoloader.min.js"></script></head><body class="overflow-y-scroll"><div class="container mx-auto xl:max-w-screen-lg"><div class="px-2 grid grid-cols-12"><div class="hidden md:mr-4 md:block md:col-span-3 "><div class="mt-2 h-full flex pl-2 space-x-2 items-end"><a href="/"><img class="z-50 transition transform hover:scale-125 hover:opacity-80 h-20" src="/ema.svg"></a></div></div><div class="col-span-12 md:col-span-9"><div class="flex justify-center items-center"><h1 class="text-6xl mt-2 mb-2 text-center pb-2">Working with files</h1></div></div></div><div class="px-2 grid grid-cols-12"><div class="hidden md:mr-4 md:block md:col-span-3 md:sticky md:top-0 md:h-screen overflow-x-auto"><div class="bg-pink-50 rounded pt-1 pb-2"><div class="pl-2"><div class="my-2 "><a class=" hover:text-black  " href="/start">Getting Started</a></div><div class="pl-2"><div class="my-2 text-gray-600"><a class=" hover:text-black  " href="/start/tutorial">Tutorial</a></div><div class="pl-2"></div></div><div class="my-2 "><a class=" hover:text-black  " href="/guide">Guide</a></div><div class="pl-2"><div class="my-2 text-gray-600"><a class=" hover:text-black  " href="/guide/model">Defining your model</a></div><div class="pl-2"></div><div class="my-2 text-gray-600"><a class=" hover:text-black  " href="/guide/routes">Working with routes</a></div><div class="pl-2"></div><div class="my-2 text-gray-600"><a class=" hover:text-black  " href="/guide/class">Defining Ema instance</a></div><div class="pl-2"></div><div class="my-2 text-gray-600"><a class=" hover:text-black  " href="/guide/render">Rendering HTML</a></div><div class="pl-2"></div><div class="my-2 "><a class=" hover:text-black  " href="/guide/helpers">Helpers</a></div><div class="pl-2"><div class="my-2 text-gray-600"><a class=" hover:text-black  " href="/guide/helpers/tailwind">Using Tailwind CSS</a></div><div class="pl-2"></div><div class="my-2 text-gray-600"><a class=" hover:text-black  text-pink-600 font-bold" href="/guide/helpers/filesystem">Working with files</a></div><div class="pl-2"></div><div class="my-2 text-gray-600"><a class=" hover:text-black  " href="/guide/helpers/markdown">Using Markdown</a></div><div class="pl-2"></div></div></div><div class="my-2 "><a class=" hover:text-black  " href="/concepts">Concepts</a></div><div class="pl-2"><div class="my-2 text-gray-600"><a class=" hover:text-black  " href="/concepts/hot-reload">Hot Reload</a></div><div class="pl-2"></div><div class="my-2 text-gray-600"><a class=" hover:text-black  " href="/concepts/lvar">LVar</a></div><div class="pl-2"></div><div class="my-2 text-gray-600"><a class=" hover:text-black  " href="/concepts/slug">Slug</a></div><div class="pl-2"></div><div class="my-2 text-gray-600"><a class=" hover:text-black  " href="/concepts/cli">CLI</a></div><div class="pl-2"></div><div class="my-2 text-gray-600"><a class=" hover:text-black  " href="/concepts/logging">Logging</a></div><div class="pl-2"></div></div></div></div></div><div class="col-span-12 md:col-span-9"><div class="w-full text-gray-600 mt-4 block md:hidden"><div class="flex justify-center"><div class="w-full bg-white py-2 rounded"><ul class="flex text-gray-500 text-sm lg:text-base"><li class="inline-flex items-center"><a class="px-1 font-bold bg-pink-500 text-gray-50 rounded" href="/">Ema</a><svg fill="currentColor" viewBox="0 0 20 20" class="h-5 w-auto text-gray-400"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></li><li class="inline-flex items-center"><a class="px-1 font-bold bg-pink-500 text-gray-50 rounded" href="/guide">Guide</a><svg fill="currentColor" viewBox="0 0 20 20" class="h-5 w-auto text-gray-400"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></li><li class="inline-flex items-center"><a class="px-1 font-bold bg-pink-500 text-gray-50 rounded" href="/guide/helpers">Helpers</a><svg fill="currentColor" viewBox="0 0 20 20" class="h-5 w-auto text-gray-400"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></li><li class="inline-flex items-center text-gray-600"><a>Working with files</a></li></ul></div></div></div><p class="my-2">If your static site is generated depending on local files on disk, the general flow of things is as follows:</p><div class="py-0.5 text-sm"><pre class="haskell language-haskell"><code class="haskell language-haskell">runEma render $ \model -&gt; do
  -- Load everything on launch
  initialModel &lt;- loadFilesAndBuildModel
  LVar.set model initialModel
  -- Continue to monitor and update the model
  observeFileSystem $ \action -&gt; 
    LVar.modify model $ applyAction action</code></pre></div><p class="my-2">For monitoring local files on disk you would typically use something like <a class="text-pink-600 hover:underline" href="https://hackage.haskell.org/package/fsnotify" title="" target="_blank" rel="noopener">fsnotify</a> in place of <code>observeFileSystem</code>. What is the point of doing this? To support <a class="text-pink-600 font-bold hover:bg-pink-50" href="/concepts/hot-reload" title="">hot reload</a> on <em>data</em> change. Imagine that your static site is generated based on Markdown files as well as HTML templates on disk. If either the Markdown file, or a HTML template file is modified, we want the web browser to hot reload the updated HTML <em>instantly</em>. This is enabled by storing both these kinds of files in the application <a class="text-pink-600 font-bold hover:bg-pink-50" href="/guide/model" title="">model</a> and using <a class="text-pink-600 font-bold hover:bg-pink-50" href="/concepts/lvar" title="">LVar</a> to update it <em>over time</em>.</p><p class="my-2">For filesystem changes, Ema provides a helper based on <code>fsnotify</code> in the <code>Ema.Helper.FileSystem</code> module. You can use it as follows</p><div class="py-0.5 text-sm"><pre class="haskell language-haskell"><code class="haskell language-haskell">import qualified Ema.Helper.FileSystem as FileSystem

type Model = Map FilePath Text

Ema.runEma render $ \model -&gt; do
  LVar.set model =&lt;&lt; do
    mdFiles &lt;- FileSystem.filesMatching &quot;.&quot; [&quot;**/*.md&quot;]
    forM mdFiles readFileText
      &lt;&amp;&gt; Map.fromList 
  FileSystem.onChange &quot;.&quot; $ \fp -&gt; \case
    FileSystem.Update -&gt;
      when (takeExtension fp == &quot;.md&quot;) $ do
        log $ &quot;Update: &quot; &lt;&gt; fp 
        s &lt;- readFileText fp
        LVar.modify model $ Map.insert fp s
    FileSystem.Delete -&gt;
      whenJust (takeExtension fp == &quot;.md&quot;) $ do
        log $ &quot;Delete: &quot; &lt;&gt; fp
        LVar.modify model $ Map.delete fp</code></pre></div><p class="my-2">In most cases, however, you probably want to use the higher level function <code>mountOnLVar</code>. It “mounts” the files you specify onto the <a class="text-pink-600 font-bold hover:bg-pink-50" href="/concepts/lvar" title="">model LVar</a> such that any changes to them are <em>automatically</em> reflected in your <a class="text-pink-600 font-bold hover:bg-pink-50" href="/guide/model" title="">model</a> value.</p><div class="py-0.5 text-sm"><pre class="haskell language-haskell"><code class="haskell language-haskell">Ema.runEma render $ \model -&gt; do
  FileSystem.mountOnLVar &quot;.&quot; [&quot;**/*.md&quot;] model $ \fp -&gt; \case
    FileSystem.Update -&gt; do
      s &lt;- readFileText fp
      pure $ Map.insert fp s
    FileSystem.Delete -&gt;
      pure $ Map.delete fp</code></pre></div><p class="my-2"><a class="text-pink-600 hover:underline" href="https://github.com/srid/ema-docs/blob/master/src/Main.hs" title="" target="_blank" rel="noopener">Full example here</a>.</p><footer class="flex justify-center items-center space-x-4 my-8 text-center text-gray-500"><a href="https://github.com/srid/ema-docs/edit/master/content/guide/helpers/filesystem.md" title="Edit this page on GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
  <path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" />
  <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" />
</svg></a><div>Powered by <a class="font-bold" href="https://github.com/srid/ema">Ema</a></div></footer></div></div></div></body></html>