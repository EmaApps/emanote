<!DOCTYPE HTML>
<html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><script type="text/javascript" src="https://cdn.jsdelivr.net/combine/npm/twind/twind.umd.min.js,npm/twind/observe/observe.umd.min.js"></script><script type="text/javascript">twind.setup({})
twindObserve.observe(document.documentElement)</script><title>Tutorial – Ema</title><meta name="description" content="Ema static site generator (Jamstack) in Haskell"><link href="/ema.svg" rel="icon" /><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#DB2777"><link href="https://cdn.jsdelivr.net/npm/prismjs@1.23.0/themes/prism-tomorrow.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/combine/npm/prismjs@1.23.0/prism.min.js,npm/prismjs@1.23.0/plugins/autoloader/prism-autoloader.min.js"></script></head><body class="overflow-y-scroll"><div class="container mx-auto xl:max-w-screen-lg"><div class="px-2 grid grid-cols-12"><div class="hidden md:mr-4 md:block md:col-span-3 "><div class="mt-2 h-full flex pl-2 space-x-2 items-end"><a href="/"><img class="z-50 transition transform hover:scale-125 hover:opacity-80 h-20" src="/ema.svg"></a></div></div><div class="col-span-12 md:col-span-9"><div class="flex justify-center items-center"><h1 class="text-6xl mt-2 mb-2 text-center pb-2">Tutorial</h1></div></div></div><div class="px-2 grid grid-cols-12"><div class="hidden md:mr-4 md:block md:col-span-3 md:sticky md:top-0 md:h-screen overflow-x-auto"><div class="bg-pink-50 rounded pt-1 pb-2"><div class="pl-2"><div class="my-2 "><a class=" hover:text-black  " href="/start">Getting Started</a></div><div class="pl-2"><div class="my-2 text-gray-600"><a class=" hover:text-black  text-pink-600 font-bold" href="/start/tutorial">Tutorial</a></div><div class="pl-2"></div></div><div class="my-2 "><a class=" hover:text-black  " href="/guide">Guide</a></div><div class="pl-2"><div class="my-2 text-gray-600"><a class=" hover:text-black  " href="/guide/model">Defining your model</a></div><div class="pl-2"></div><div class="my-2 text-gray-600"><a class=" hover:text-black  " href="/guide/routes">Working with routes</a></div><div class="pl-2"></div><div class="my-2 text-gray-600"><a class=" hover:text-black  " href="/guide/class">Defining Ema instance</a></div><div class="pl-2"></div><div class="my-2 text-gray-600"><a class=" hover:text-black  " href="/guide/render">Rendering HTML</a></div><div class="pl-2"></div><div class="my-2 "><a class=" hover:text-black  " href="/guide/helpers">Helpers</a></div><div class="pl-2"><div class="my-2 text-gray-600"><a class=" hover:text-black  " href="/guide/helpers/tailwind">Using Tailwind CSS</a></div><div class="pl-2"></div><div class="my-2 text-gray-600"><a class=" hover:text-black  " href="/guide/helpers/filesystem">Working with files</a></div><div class="pl-2"></div><div class="my-2 text-gray-600"><a class=" hover:text-black  " href="/guide/helpers/markdown">Using Markdown</a></div><div class="pl-2"></div></div></div><div class="my-2 "><a class=" hover:text-black  " href="/concepts">Concepts</a></div><div class="pl-2"><div class="my-2 text-gray-600"><a class=" hover:text-black  " href="/concepts/hot-reload">Hot Reload</a></div><div class="pl-2"></div><div class="my-2 text-gray-600"><a class=" hover:text-black  " href="/concepts/lvar">LVar</a></div><div class="pl-2"></div><div class="my-2 text-gray-600"><a class=" hover:text-black  " href="/concepts/slug">Slug</a></div><div class="pl-2"></div><div class="my-2 text-gray-600"><a class=" hover:text-black  " href="/concepts/cli">CLI</a></div><div class="pl-2"></div><div class="my-2 text-gray-600"><a class=" hover:text-black  " href="/concepts/logging">Logging</a></div><div class="pl-2"></div></div></div></div></div><div class="col-span-12 md:col-span-9"><div class="w-full text-gray-600 mt-4 block md:hidden"><div class="flex justify-center"><div class="w-full bg-white py-2 rounded"><ul class="flex text-gray-500 text-sm lg:text-base"><li class="inline-flex items-center"><a class="px-1 font-bold bg-pink-500 text-gray-50 rounded" href="/">Ema</a><svg fill="currentColor" viewBox="0 0 20 20" class="h-5 w-auto text-gray-400"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></li><li class="inline-flex items-center"><a class="px-1 font-bold bg-pink-500 text-gray-50 rounded" href="/start">Getting Started</a><svg fill="currentColor" viewBox="0 0 20 20" class="h-5 w-auto text-gray-400"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path></svg></li><li class="inline-flex items-center text-gray-600"><a>Tutorial</a></li></ul></div></div></div><p class="my-2">Make sure that you have have followed <a class="text-pink-600 font-bold hover:bg-pink-50" href="/start" title="">the previous section</a> in order to have the <a class="text-pink-600 hover:underline" href="https://github.com/srid/ema-docs" title="" target="_blank" rel="noopener">template repo</a> checked out and running locally. Here, <strong>our goal</strong> is to replace the source code of the template repo and write a basic site from scratch.</p><ol class="list-inside ml-2 space-y-1  list-decimal"><li class="">Follow the template repo’s <a class="text-pink-600 hover:underline" href="https://github.com/srid/ema-docs#getting-started" title="" target="_blank" rel="noopener">README</a> and have it open in Visual Studio Code while running the dev server. Your website should be viewable at <a class="text-pink-600 hover:underline" href="http://localhost:9001/" title="" target="_blank" rel="noopener">http://localhost:9001/</a></li><li class="">Open <code>src/Main.hs</code></li><li class="">Delete everything in it, and replace it with the following</li></ol><div class="py-0.5 text-sm"><pre class="haskell language-haskell"><code class="haskell language-haskell">module Main where

import qualified Ema

main :: IO ()
main = do
  let speaker :: Text = &quot;Ema&quot;
  Ema.runEmaPure $ \_ -&gt;
    encodeUtf8 $ &quot;&lt;b&gt;Hello&lt;/b&gt;, from &quot; &lt;&gt; speaker</code></pre></div><p class="my-2">This is the <em>minimum</em> amount of code necessary to run an Ema site. Notice that as you replace and save this file, your browser (which is at <a class="text-pink-600 hover:underline" href="http://locahost:9001" title="" target="_blank" rel="noopener">http://locahost:9001</a>) will <a class="text-pink-600 font-bold hover:bg-pink-50" href="/concepts/hot-reload" title="">hot reload</a> to display “Hello, Ema”. Congratulations, you just created your first website!</p><h2 class="text-5xl mt-4 mb-2 text-gray-700" id="expanding-on-hello-world">Expanding on Hello World</h2><p class="my-2">Okay, but that’s just <em>one</em> page. But we want to add a second page. And might as well add more content than “Hello, Ema”. Let’s do that next. The first step is define the <a class="text-pink-600 font-bold hover:bg-pink-50" href="/guide/routes" title="">route</a> type that corresponds to our site’s pages. Add the following:</p><div class="py-0.5 text-sm"><pre class="haskell language-haskell"><code class="haskell language-haskell">data Route
  = Index  -- Corresponds to /
  | About  -- Corresponds to /about
  deriving (Bounded, Enum, Show)</code></pre></div><p class="my-2">Next, let’s define a <a class="text-pink-600 font-bold hover:bg-pink-50" href="/guide/model" title="">model</a>. A model will hold the state of our website used to render its HTML. Let’s put the <code>speaker</code> variable in it, as that’s all we are using:</p><div class="py-0.5 text-sm"><pre class="haskell language-haskell"><code class="haskell language-haskell">data Model = Model { speaker :: Text }</code></pre></div><p class="my-2">We should now tell Ema how to convert our <code>Route</code> to actual URL paths. Let’s do that by making an instance of the <code>Ema</code> <a class="text-pink-600 font-bold hover:bg-pink-50" href="/guide/class" title="">class</a>:</p><div class="py-0.5 text-sm"><pre class="haskell language-haskell"><code class="haskell language-haskell">import Ema (Ema (..))

instance Ema Model Route where
  encodeRoute = \case
    Index -&gt; []         -- To /
    About -&gt; [&quot;about&quot;]  -- To /about
  decodeRoute = \case
    [] -&gt; Just Index         -- From /
    [&quot;about&quot;] -&gt; Just About  -- From /about
    _ -&gt; Nothing             -- Everything else, are bad routes</code></pre></div><p class="my-2">Now, we write the <code>main</code> entry point:</p><div class="py-0.5 text-sm"><pre class="haskell language-haskell"><code class="haskell language-haskell">import Control.Concurrent (threadDelay)
import qualified Data.LVar as LVar

main :: IO ()
main = do
  Ema.runEma render $ \model -&gt; do
    LVar.set model $ Model &quot;Ema&quot;
    liftIO $ threadDelay maxBound</code></pre></div><p class="my-2">The <code>runEma</code> function is explained <a class="text-pink-600 font-bold hover:bg-pink-50" href="/guide/class" title="">here</a>, but in brief: it takes a render function (see below) as well as an IO action that allows us to create and update the model <a class="text-pink-600 font-bold hover:bg-pink-50" href="/concepts/lvar" title="">lvar</a>. Note that <code>threadDelay maxBound</code> here? That is because our IO action must not exit; in the dev server mode of real-world websites, you would continue to monitor the external world (such as Markdown files) and update the model, to facilitate <a class="text-pink-600 font-bold hover:bg-pink-50" href="/concepts/hot-reload" title="">hot reload</a> of data used by your site.</p><p class="my-2">On final piece of the puzzle is to write the aforementioned <code>render</code> function:</p><div class="py-0.5 text-sm"><pre class="haskell language-haskell"><code class="haskell language-haskell">import qualified Ema.CLI
import qualified Ema.Helper.Tailwind as Tailwind
import Text.Blaze.Html5 ((!))
import qualified Text.Blaze.Html5 as H
import qualified Text.Blaze.Html5.Attributes as A
import qualified Text.Blaze.Html.Renderer.Utf8 as RU

render :: Ema.CLI.Action -&gt; Model -&gt; Route -&gt; LByteString
render _emaAction model r = RU.renderHtml $
  H.html $ do
    H.head $ do 
      H.title &quot;Basic site&quot;
    H.body $ do
      H.div ! A.class_ &quot;container&quot; $ do
        case r of
          Index -&gt; do
            H.toHtml $
              &quot;You are on the index page. The name is &quot; &lt;&gt; speaker model
            routeElem About &quot;Go to About&quot;
          About -&gt; do
            &quot;You are on the about page. &quot;
            routeElem Index &quot;Go to Index&quot;
  where
    routeElem targetRoute w =
      H.a 
        ! A.style &quot;text-decoration: underline&quot; 
        ! A.href (H.toValue $ Ema.routeUrl targetRoute) $ w</code></pre></div><p class="my-2">If everything compiles, you should see the site update in the web browser. A couple of quick points about the <code>render</code> function:</p><ol class="list-inside ml-2 space-y-1  list-decimal"><li class="">It should return the raw HTML as a <code>ByteString</code>. Here, we use <a class="text-pink-600 hover:underline" href="https://hackage.haskell.org/package/blaze-html" title="" target="_blank" rel="noopener">blaze-html</a> as HTML DSL. You can also use your own HTML templates of course.</li><li class="">It uses <code>Ema.routeUrl</code> function to create a URL out of our <code>Route</code> type. This function uses the <a class="text-pink-600 font-bold hover:bg-pink-50" href="/guide/class" title=""><code>Ema</code> typeclass</a>, so it uses the <code>encodeRoute</code> function defined further above.</li></ol><p class="my-2">On final note, you will note that nothing is actually <em>generated</em> so far. This is because Ema has been running in the dev server mode, which is quite useful during development. To actually generate the files, you can use the <code>gen</code> command when running the <a class="text-pink-600 font-bold hover:bg-pink-50" href="/concepts/cli" title="">CLI</a>:</p><div class="py-0.5 text-sm"><pre class="bash language-bash"><code class="bash language-bash">mkdir ./output
nix run . -- -C ./content gen ./output</code></pre></div><h2 class="text-5xl mt-4 mb-2 text-gray-700" id="exercises">Exercises</h2><ol class="list-inside ml-2 space-y-1  list-decimal"><li class="">Figure out how to use static assets (images, files) in your static sites (hint: the typeclass)</li><li class="">What happens if you <code>throw</code> an exception or use <code>error</code> in the <code>render</code> function?</li></ol><div class="mt-8 border-t-2 border-pink-500 pb-1 pl-1 bg-gray-50 rounded"><p class="my-2"><span class="py-2 text-xl italic font-bold">Next</span>, checkout the <a class="text-pink-600 font-bold hover:bg-pink-50" href="/guide" title="">Guide</a> series for information on specific topics.</p></div><footer class="flex justify-center items-center space-x-4 my-8 text-center text-gray-500"><a href="https://github.com/srid/ema-docs/edit/master/content/start/tutorial.md" title="Edit this page on GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
  <path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" />
  <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" />
</svg></a><div>Powered by <a class="font-bold" href="https://github.com/srid/ema">Ema</a></div></footer></div></div></div></body></html>